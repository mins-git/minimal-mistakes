---
layout: single
title: "[Project] μ–΄λ…Έν…μ΄μ… / λ©”μ„λ“ / λ‹¨μ–΄ μ •λ¦¬ "
categories: Project
tag: [back-end, fornt-end, project]
toc: true
toc_sticky: true
toc_label: index
toc_icon: "fa-solid fa-indent"
author_profile: false
# sidebar:
#     nav: "docs"
# search: false

---



<br/>

<br/>

**2023.04.17 μμ •λ¨.**

<br/>



## μ–΄λ…Έν…μ΄μ… μ •λ¦¬

- ### **@GeneratedValue μ–΄λ…Έν…μ΄μ…? :**

`@GeneratedValue` μ–΄λ…Έν…μ΄μ…μ€ JPAμ—μ„ Entity ν΄λμ¤μ κΈ°λ³Έ ν‚¤λ¥Ό μλ™μΌλ΅ μƒμ„±ν•κΈ° μ„ν•΄ μ‚¬μ©λ©λ‹λ‹¤. μ΄ μ–΄λ…Έν…μ΄μ…μ€ `@Id` μ–΄λ…Έν…μ΄μ…κ³Ό ν•¨κ» μ‚¬μ©λλ©°, `strategy` μ†μ„±μ„ ν†µν•΄ μ–΄λ–¤ λ°©μ‹μΌλ΅ κΈ°λ³Έ ν‚¤λ¥Ό μƒμ„±ν• μ§€ μ„¤μ •ν•  μ μμµλ‹λ‹¤.   

κ·Έλ¬λ©΄ strategy μ†μ„±μ—λ” μ–΄λ–¤ κ°’μ΄ μμ„κΉ? β†“ `λ€ν‘μ μΈ κ°’ 3κ°€μ§€`   

1. `GenerationType.IDENTITY`: λ°μ΄ν„°λ² μ΄μ¤μ—μ„ κΈ°λ³Έ ν‚¤ μƒμ„±μ„ μ²λ¦¬ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄ MySQLμ—μ„λ” AUTO_INCREMENTλ¥Ό μ‚¬μ©ν•μ—¬ κΈ°λ³Έ ν‚¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
2. `GenerationType.SEQUENCE`: λ°μ΄ν„°λ² μ΄μ¤ μ‹ν€€μ¤λ¥Ό μ‚¬μ©ν•μ—¬ κΈ°λ³Έ ν‚¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤. μ΄ λ°©μ‹μ€ Oracleκ³Ό κ°™μ€ λ‡λ‡ λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.
3. `GenerationType.TABLE`: λ°μ΄ν„°λ² μ΄μ¤μ νΉλ³„ν• ν…μ΄λΈ”μ—μ„ κΈ°λ³Έ ν‚¤ κ°’μ„ κ°€μ Έμµλ‹λ‹¤. μ΄ λ°©μ‹μ€ λ¨λ“  λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.   

<BR>

**λ‚λ” MySQLμ„ μ‚¬μ©ν• κ²ƒμ΄κΈ°μ— IDENTITY μ†μ„±μ„ μ‚¬μ©ν•  κ²ƒμ΄λ‹¤.**   

`GenerationType.IDENTITY`λ” λ§¤μ° μΌλ°μ μΈ μ „λµμΌλ΅, λ€λ¶€λ¶„μ λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ§€μ›λ©λ‹λ‹¤. λ‹¤λ¥Έ μ „λµμ€ λ°μ΄ν„°λ² μ΄μ¤μ μΆ…λ¥λ‚ μ„¤μ •μ— λ”°λΌ μ§€μ›λμ§€ μ•μ„ μλ„ μμµλ‹λ‹¤. κΈ°λ³Έ ν‚¤λ¥Ό μƒμ„±ν•λ” λ°©μ‹μ€ JPA κµ¬ν„μ²΄μ—μ„ μ§€μ›ν•λ” λ°©μ‹κ³Ό λ°μ΄ν„°λ² μ΄μ¤ μΆ…λ¥ λ° μ„¤μ •μ— λ”°λΌ λ‹¬λΌμ§ μ μμµλ‹λ‹¤.   

<br>

μλ¥Ό λ“¤μ–΄, λ‹¤μκ³Ό κ°™μ΄ Entity ν΄λμ¤λ¥Ό μ‘μ„±ν•λ©΄ `GenerationType.IDENTITY`λ¥Ό μ‚¬μ©ν•μ—¬ MySQLμ—μ„ μλ™μΌλ΅ κΈ°λ³Έ ν‚¤λ¥Ό μƒμ„±ν•  μ μμµλ‹λ‹¤.

```java
public class User {
 
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
}
```

<br>

<br>

- ### **π”‘ @ElementCollection μ΄λ€?**

  JPAμ—μ„λ” μ—”ν‹°ν‹° ν΄λμ¤μ™€ κ΄€λ ¨λ ν…μ΄λΈ”μ„ μλ™μΌλ΅ μƒμ„±ν•΄μ£Όλ”λ°, μ΄λ• ν•„λ“μ™€ μ»¬λΌμ„ λ§¤ν•‘ν•΄μ£Όλ” μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•©λ‹λ‹¤.

  `@ElementCollection` μ–΄λ…Έν…μ΄μ…μ€ μ—”ν‹°ν‹°μ—μ„ μ»¬λ ‰μ…μ„ λ§¤ν•‘ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ•„λμ™€ κ°™μ΄ `User` μ—”ν‹°ν‹° ν΄λμ¤μ— `List<String>` νƒ€μ…μ `roles` ν•„λ“κ°€ μλ‹¤κ³  κ°€μ •ν•΄λ³΄κ² μµλ‹λ‹¤.

  ```java
  @Entity
  public class User {
      @Id
      private Long id;
      private String name;
      
      @ElementCollection
      private List<String> roles;
      // ...
  }
  
  ```

  μ΄ κ²½μ° `roles` ν•„λ“λ” `@ElementCollection` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ μ—”ν‹°ν‹°μ—μ„ μ»¬λ ‰μ…μΌλ΅ λ§¤ν•‘λ©λ‹λ‹¤. 

  JPAλ” `User` ν…μ΄λΈ” μ™Έμ—λ„ `User_roles`μ™€ κ°™μ€ μ΄λ¦„μ ν…μ΄λΈ”μ„ μλ™μΌλ΅ μƒμ„±ν•μ—¬ `User` μ—”ν‹°ν‹°μ™€ `roles` μ»¬λ ‰μ…μ„ λ§¤ν•‘ν•΄μ¤λ‹λ‹¤. μ΄λ• `User_roles` ν…μ΄λΈ”μ€ `id`μ™€ `value` λ‘ κ°μ μ»¬λΌμ„ κ°€μ§€λ©°, `id` μ»¬λΌμ€ `User` μ—”ν‹°ν‹°μ κΈ°λ³Έ ν‚¤μΈ `id`μ™€ λ§¤ν•‘λκ³ , `value` μ»¬λΌμ€ `roles` μ»¬λ ‰μ…μ κ° μ›μ†μ™€ λ§¤ν•‘λ©λ‹λ‹¤.

  λ”°λΌμ„, `@ElementCollection` μ–΄λ…Έν…μ΄μ…μ€ μ—”ν‹°ν‹°μ—μ„ μ»¬λ ‰μ…μ„ λ§¤ν•‘ν•μ—¬, μ—”ν‹°ν‹° ν΄λμ¤μ™€ μ»¬λ ‰μ…μ„ λ§¤ν•‘ν•λ” μ¤‘κ°„ ν…μ΄λΈ”μ„ μλ™μΌλ΅ μƒμ„±ν•΄μ¤λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ κ°μ²΄μ§€ν–¥ ν”„λ΅κ·Έλλ°μ—μ„ μ‚¬μ©ν•λ” μ»¬λ ‰μ…μ„ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•  μ μμµλ‹λ‹¤.

  <br>

  κ²°κ³Όμ μΌλ΅λ” `@ElementCollection` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ μ»¬λ ‰μ…μ„ λ§¤ν•‘ν•  λ•, ν•΄λ‹Ή μ»¬λ ‰μ…μ μ›μ†λ“¤μ€ λ³„λ„μ ν…μ΄λΈ”μ— μ €μ¥λ©λ‹λ‹¤. μ΄λ• `@ElementCollection` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν• ν•„λ“κ°€ μ†ν• μ—”ν‹°ν‹° ν΄λμ¤μ `@Id` μ–΄λ…Έν…μ΄μ…μ΄ μ μ©λ ν•„λ“μ™€ κ°™μ€ κΈ°λ³Έ ν‚¤λ¥Ό κ³µμ ν•©λ‹λ‹¤. λ”°λΌμ„, μ»¬λ ‰μ…μ μ›μ†λ“¤μ΄ μ €μ¥λ  λ• μ—”ν‹°ν‹° ν΄λμ¤μ™€ μ»¬λ ‰μ…μ μ›μ†λ“¤μ΄ λ§¤ν•‘λλ” ν…μ΄λΈ”μ— `@Id` μ–΄λ…Έν…μ΄μ…μΌλ΅ μ§€μ •ν• ν•„λ“κ°’κ³Ό ν•¨κ» μ €μ¥λμ–΄, μ—”ν‹°ν‹° κ°μ²΄μ™€ μ»¬λ ‰μ… κ°μ²΄λ¥Ό μ„λ΅ μ—°κ²°ν•  μ μκ² λ©λ‹λ‹¤.

  <br>

  **μ§κ΄€μ μΈ μμ‹ μ„ κ°™μ€ μ½”λ“κ°€ μλ‹¤λ©΄,**

  ```java
  +-------------+
  |  user_roles |
  +-------------+
  | user_id (PK) |
  | value       |
  +-------------+
  
  ```

  

  `User` μ—”ν‹°ν‹°μ™€ `roles` μ»¬λ ‰μ…μ„ λ§¤ν•‘ν•λ” μ¤‘κ°„ ν…μ΄λΈ”μΈ `user_roles` ν…μ΄λΈ”μ€ λ‹¤μκ³Ό κ°™μ΄ μƒμ„±λ©λ‹λ‹¤.

  μ—¬κΈ°μ„ `user_id` μ»¬λΌμ€ `User` μ—”ν‹°ν‹°μ κΈ°λ³Έ ν‚¤μΈ `id`μ™€ λ§¤ν•‘λλ©°, `value` μ»¬λΌμ€ `roles` μ»¬λ ‰μ…μ κ° μ›μ†μ™€ λ§¤ν•‘λ©λ‹λ‹¤. λ”°λΌμ„, `User` μ—”ν‹°ν‹° κ°μ²΄μ `id` ν•„λ“μ™€ `roles` μ»¬λ ‰μ… κ°μ²΄μ κ° μ›μ†κ°€ λ§¤ν•‘λλ” `user_roles` ν…μ΄λΈ”μ—λ” λ‹¤μκ³Ό κ°™μ€ λ°μ΄ν„°κ°€ μ €μ¥λ©λ‹λ‹¤.

  <br>

  ```java
  +---------+-------+
  | user_id | value |
  +---------+-------+
  |       1 | USER  |
  |       1 | ADMIN |
  +---------+-------+
  
  ```

  μ„μ μμ‹μ—μ„ `User` μ—”ν‹°ν‹°μ `id` ν•„λ“κ°’μ΄ 1μ΄λΌκ³  κ°€μ •ν•©λ‹λ‹¤. μ΄λ• `roles` μ»¬λ ‰μ…μ—λ” "USER"μ™€ "ADMIN"μ΄λΌλ” λ‘ κ°μ μ›μ†κ°€ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤. `@ElementCollection` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ `roles` ν•„λ“λ¥Ό λ§¤ν•‘ν•λ©΄, μ΄ μ»¬λ ‰μ…μ κ° μ›μ†λ” `user_roles` ν…μ΄λΈ”μ— μ €μ¥λ©λ‹λ‹¤. μ €μ¥λ  λ• `User` μ—”ν‹°ν‹°μ `id` ν•„λ“κ°’κ³Ό ν•¨κ» μ €μ¥λμ–΄, `User` μ—”ν‹°ν‹° κ°μ²΄μ™€ `roles` μ»¬λ ‰μ… κ°μ²΄λ¥Ό μ„λ΅ μ—°κ²°ν•  μ μκ² λ©λ‹λ‹¤.

  <br>

  <br>

  **κ·Έλ¬λ©΄ μ—¬κΈ°μ—μ„ fetchλ” λ­κΉ?**

  ```java
   @ElementCollection(fetch = FetchType.EAGER)
  ```

  `fetch` μ†μ„±μ€ `@ElementCollection` μ–΄λ…Έν…μ΄μ…κ³Ό ν•¨κ» μ‚¬μ©ν•μ—¬ μ»¬λ ‰μ…μ„ λ΅λ“ν•  λ• μ–΄λ–»κ² λ΅λ“ν• μ§€λ¥Ό μ„¤μ •ν•©λ‹λ‹¤. `fetch` μ†μ„±μ€ λ‹¤μκ³Ό κ°™μ€ μµμ…μ„ κ°€μ§ μ μμµλ‹λ‹¤.

  - `FetchType.EAGER`: μ¦‰μ‹ λ΅λ“ν•©λ‹λ‹¤. `User` μ—”ν‹°ν‹°λ¥Ό μ΅°νν•  λ• `roles` μ»¬λ ‰μ…μ„ ν•¨κ» μ΅°νν•©λ‹λ‹¤.
  - `FetchType.LAZY`: μ§€μ—° λ΅λ“ν•©λ‹λ‹¤. `User` μ—”ν‹°ν‹°λ¥Ό μ΅°νν•  λ• `roles` μ»¬λ ‰μ…μ€ λ΅λ“ν•μ§€ μ•κ³ , μ‹¤μ λ΅ μ‚¬μ©λ  λ• λ΅λ“λ©λ‹λ‹¤.

  λ”°λΌμ„ `@ElementCollection(fetch = FetchType.EAGER)`λ” `User` μ—”ν‹°ν‹°λ¥Ό μ΅°νν•  λ• `roles` μ»¬λ ‰μ…λ„ ν•¨κ» μ΅°νν•λ„λ΅ μ„¤μ •ν•λ” κ²ƒμ…λ‹λ‹¤. μ΄λ ‡κ² ν•¨μΌλ΅μ¨, `User` μ—”ν‹°ν‹° κ°μ²΄μ™€ ν•¨κ» `roles` μ»¬λ ‰μ… κ°μ²΄λ„ λ΅λ“λλ―€λ΅, `roles` μ»¬λ ‰μ…μ— μ ‘κ·Όν•  λ• μ§€μ—° λ΅λ”©μΌλ΅ μΈν• μ„±λ¥ λ¬Έμ λ¥Ό ν”Όν•  μ μμµλ‹λ‹¤.

  λ°λ©΄μ— `@ElementCollection(fetch = FetchType.LAZY)`λ¥Ό μ‚¬μ©ν•λ©΄, `User` μ—”ν‹°ν‹°λ¥Ό μ΅°νν•  λ• `roles` μ»¬λ ‰μ…μ€ λ΅λ“λμ§€ μ•μµλ‹λ‹¤. λ€μ‹ , `roles` μ»¬λ ‰μ…μ— μ‹¤μ λ΅ μ ‘κ·Όν•  λ• λ΅λ“λ©λ‹λ‹¤. μ΄ λ°©λ²•μ€ `roles` μ»¬λ ‰μ…μ΄ ν° κ²½μ° μ„±λ¥μ„ ν–¥μƒμ‹ν‚¬ μ μμµλ‹λ‹¤.   









## λ©”μ„λ“ μ •λ¦¬

- `.and()` : `.and()` λ©”μ„λ“λ” `HttpSecurity` λΉλ”μ μ²΄μΈ λΉλ”©μ„ κ°€λ¥ν•κ² ν•©λ‹λ‹¤. `HttpSecurity` κ°μ²΄λ” Spring Security κµ¬μ„±μ„ κµ¬ν„ν•λ” λ° μ‚¬μ©λλ©°, κµ¬μ„±μ€ μ²΄μΈ λΉλ” ν¨ν„΄μ„ μ‚¬μ©ν•μ—¬ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤. μ΄ λ•, `and()` λ©”μ„λ“λ” μ΄μ „ λ©”μ„λ“κ°€ κµ¬μ„±ν• λ³΄μ• κµ¬μ„±μ μΌλ¶€λ¶„μ„ κµ¬μ„±ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤. μ¦‰, `and()` λ©”μ„λ“λ” μ΄μ „ λ³΄μ• κµ¬μ„±μ— λ€ν• κ³„μ†μ μΈ μ„¤μ •μ΄ κ°€λ¥ν•λ„λ΅ ν•κΈ° μ„ν•΄ μ‚¬μ©λ©λ‹λ‹¤.
- 
- 









## λ‹¨μ–΄μ •λ¦¬

- `νμ‹±` : **νμ‹±(Parsing)**μ€ μ–΄λ–¤ λ°μ΄ν„°λ‚ ν…μ¤νΈμ—μ„ νΉμ •ν• ν¨ν„΄μ„ μ°Ύμ•„λ‚΄μ–΄ κ·Έκ²ƒμ„ ν•΄μ„ν•κ±°λ‚ λ¶„μ„ν•λ” κ²ƒμ„ λ§ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ›Ή μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° λ°›μ€ HTTP μ”μ²­ λ©”μ‹μ§€λ¥Ό ν•΄μ„ν•΄μ„ μ”μ²­ν• νμ΄μ§€μ μ •λ³΄λ¥Ό νμ•…ν•κ±°λ‚, ν”„λ΅κ·Έλλ°μ—μ„ λ¬Έμμ—΄μ—μ„ μ›ν•λ” μ •λ³΄λ¥Ό μ¶”μ¶ν•κΈ° μ„ν•΄ λ¬Έμμ—΄ νμ‹±μ„ μν–‰ν•λ” λ“±μ μ‘μ—…μ—μ„ μ‚¬μ©λ©λ‹λ‹¤. νμ‹±μ€ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•κ±°λ‚ λ¶„μ„ν•λ”λ° μ¤‘μ”ν• κΈ°μ  μ¤‘ ν•λ‚μ…λ‹λ‹¤.   
- `JwtTokenizer`: JWT(Json Web Token)λ¥Ό μƒμ„±ν•κ³  νμ‹±ν•λ” μ—­ν• μ„ ν•©λ‹λ‹¤.   
- `CustomUserDetailsService`: Spring Securityμ `UserDetailsService`λ¥Ό κµ¬ν„ν• μ»¤μ¤ν…€ μ„λΉ„μ¤λ΅, μ‚¬μ©μ μ •λ³΄λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ΅°νν•κ³  μΈμ¦μ— ν•„μ”ν• μ •λ³΄λ¥Ό μ κ³µν•©λ‹λ‹¤.   
- `OAuth2UserDetailsService`: OAuth2 λ΅κ·ΈμΈ μ‹ μ‚¬μ©μ μ •λ³΄λ¥Ό κ°€μ Έμ¤κΈ° μ„ν• μ„λΉ„μ¤λ΅, OAuth2 ν”„λ΅λ°”μ΄λ”μ APIλ¥Ό νΈμ¶ν•μ—¬ μ‚¬μ©μ μ •λ³΄λ¥Ό κ°€μ Έμµλ‹λ‹¤.   
- `OAuth2UserSuccessHandler`: OAuth2 λ΅κ·ΈμΈ μ„±κ³µ ν›„μ— μ‹¤ν–‰λλ” ν•Έλ“¤λ¬λ΅, μ‚¬μ©μ μ •λ³΄λ¥Ό μΈμ¦μ„λ²„μ— μ €μ¥ν•κ±°λ‚ ν•„μ”ν• μ²λ¦¬λ¥Ό μν–‰ν•©λ‹λ‹¤.   
- `νλΌλ―Έν„°` : νλΌλ―Έν„°(parameter)λ” ν•¨μλ‚ λ©”μ„λ“ λ“±μ—μ„ μ…λ ¥κ°’μ„ μ „λ‹¬λ°›λ” λ³€μλ¥Ό λ§ν•©λ‹λ‹¤. ν•¨μλ‚ λ©”μ„λ“λ¥Ό νΈμ¶ν•  λ•, μΈμ(argument)λΌκ³ λ„ λ¶λ¦¬μ°λ” κ°’μ„ μ „λ‹¬ν•λ©΄ μ΄ κ°’μ΄ ν•¨μλ‚ λ©”μ„λ“ λ‚΄λ¶€μ νλΌλ―Έν„°λ΅ μ „λ‹¬λμ–΄ μ²λ¦¬λ©λ‹λ‹¤. νλΌλ―Έν„°λ¥Ό μ΄μ©ν•λ©΄ ν•¨μλ‚ λ©”μ„λ“κ°€ μ‹¤ν–‰λ  λ• λ™μ μΌλ΅ λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•  μ μμµλ‹λ‹¤.   
- **Cascade?**

  JPAμ—μ„ μ—”ν‹°ν‹° κ°μ²΄μ μƒνƒλ¥Ό λ³€κ²½ν•  λ•, ν•΄λ‹Ή κ°μ²΄μ™€ μ—°κ΄€λ λ‹¤λ¥Έ κ°μ²΄λ“¤μ μƒνƒλ„ ν•¨κ» λ³€κ²½ν•΄μ•Ό ν•λ” κ²½μ°κ°€ μμµλ‹λ‹¤. μ΄λ° κ²½μ°μ— `CascadeType` μ†μ„±μ„ μ‚¬μ©ν•μ—¬ μ—°κ΄€λ κ°μ²΄λ“¤μ μƒνƒλ„ ν•¨κ» λ³€κ²½ν•  μ μμµλ‹λ‹¤.

  `CascadeType`μ€ λ‹¤μκ³Ό κ°™μ€ κ°’λ“¤μ„ κ°€μ§ μ μμµλ‹λ‹¤.

  - `CascadeType.PERSIST` : μƒλ΅μ΄ κ°μ²΄λ¥Ό μ €μ¥ν•  λ• μ—°κ΄€λ κ°μ²΄λ„ ν•¨κ» μ €μ¥ν•©λ‹λ‹¤.
  - `CascadeType.MERGE` : κ°μ²΄λ¥Ό μμ •ν•  λ• μ—°κ΄€λ κ°μ²΄λ„ ν•¨κ» μμ •ν•©λ‹λ‹¤.
  - `CascadeType.REMOVE` : κ°μ²΄λ¥Ό μ‚­μ ν•  λ• μ—°κ΄€λ κ°μ²΄λ„ ν•¨κ» μ‚­μ ν•©λ‹λ‹¤.
  - `CascadeType.REFRESH` : κ°μ²΄λ¥Ό μƒλ΅κ³ μΉ¨ν•  λ• μ—°κ΄€λ κ°μ²΄λ„ ν•¨κ» μƒλ΅κ³ μΉ¨ν•©λ‹λ‹¤.
  - `CascadeType.ALL` : μ„ λ¨λ“  λ™μ‘μ„ μν–‰ν•©λ‹λ‹¤.

  `CascadeType`μ€ `@OneToOne`, `@OneToMany`, `@ManyToOne`, `@ManyToMany` μ–΄λ…Έν…μ΄μ…κ³Ό ν•¨κ» μ‚¬μ©ν•  μ μμΌλ©°, ν•„μ”μ— λ”°λΌ ν•΄λ‹Ήν•λ” μµμ…μ„ μ„ νƒν•μ—¬ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

  μλ¥Ό λ“¤μ–΄ `User` μ—”ν‹°ν‹° ν΄λμ¤μ—μ„ `CascadeType.ALL`μ„ μ„¤μ •ν• κ²½μ°, `User` κ°μ²΄μ μƒνƒκ°€ λ³€κ²½λ  λ• μ—°κ΄€λ `Reputation` κ°μ²΄μ μƒνƒλ„ ν•¨κ» λ³€κ²½λλ©°, `User` κ°μ²΄κ°€ μ‚­μ λ  λ• μ—°κ΄€λ `Reputation` κ°μ²΄λ„ ν•¨κ» μ‚­μ λ©λ‹λ‹¤.

  <br/>

  μλ¥Όλ“¤μ–΄

  `@OneToMany`μ™€ `CascadeType.ALL`μ„ μ‚¬μ©ν•΄λ³΄λ©΄,   

  ```java
  @Entity
  public class User {
      // ...
  
      @OneToMany(mappedBy = "user", cascade = CascadeType.ALL)
      private List<Post> posts = new ArrayList<>();
      
      // ...
  }
  
  @Entity
  public class Post {
      // ...
  
      @ManyToOne(fetch = FetchType.LAZY)
      @JoinColumn(name = "user_id")
      private User user;
  
      // ...
  }
  
  ```

  μ„ μμ‹μ—μ„ `User` μ—”ν‹°ν‹°λ” μ—¬λ¬ κ°μ `Post` μ—”ν‹°ν‹°λ¥Ό κ°€μ§€λ©°, `Post` μ—”ν‹°ν‹°λ” ν•λ‚μ `User` μ—”ν‹°ν‹°μ— μ†ν•©λ‹λ‹¤. `User` μ—”ν‹°ν‹°μ—μ„ `posts` ν•„λ“λ” `Post` μ—”ν‹°ν‹°μ™€ μΌλ€λ‹¤ κ΄€κ³„λ¥Ό κ°€μ§€λ©°, `mappedBy` μ†μ„±μΌλ΅ `Post` μ—”ν‹°ν‹°μ `user` ν•„λ“μ™€ λ§¤ν•‘λ©λ‹λ‹¤. `cascade` μ†μ„±μ€ `CascadeType.ALL`λ΅ μ„¤μ •λμ–΄ μμΌλ―€λ΅, `User` μ—”ν‹°ν‹°μ μƒνƒκ°€ λ³€κ²½λ  λ• μ—°κ΄€λ `Post` μ—”ν‹°ν‹°λ“¤μ μƒνƒλ„ ν•¨κ» λ³€κ²½λ©λ‹λ‹¤.   

  <br>

  λ”°λΌμ„ μ΄ μ½”λ“λ¥Ό μ‹¤ν–‰ν•κ² λλ©΄,

  ```java
  User user = new User();
  Post post1 = new Post();
  Post post2 = new Post();
  
  post1.setUser(user);
  post2.setUser(user);
  
  user.getPosts().add(post1);
  user.getPosts().add(post2);
  
  entityManager.persist(user);
  
  ```

  

  `User` μ—”ν‹°ν‹°μ™€ μ—°κ΄€λ `Post` μ—”ν‹°ν‹°λ“¤λ„ ν•¨κ» μ €μ¥λ©λ‹λ‹¤. κ·Έλ¦¬κ³  `User` μ—”ν‹°ν‹°λ¥Ό μ‚­μ ν•λ©΄ μ—°κ΄€λ `Post` μ—”ν‹°ν‹°λ“¤λ„ ν•¨κ» μ‚­μ λ©λ‹λ‹¤.   

  - `persist()` λ©”μ„λ“λ” μ—”ν‹°ν‹°λ¥Ό μμ†ν™”(persistent)ν•λ” λ©”μ„λ“μ…λ‹λ‹¤. μ¦‰, μƒλ΅μ΄ μ—”ν‹°ν‹°λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•κ±°λ‚, μ΄λ―Έ μλ” μ—”ν‹°ν‹°λ¥Ό κ°€μ Έμ™€μ„ μμ†μ„± μ»¨ν…μ¤νΈ(persistence context)μ— μ¶”κ°€ν•λ” μ‘μ—…μ„ μν–‰ν•©λ‹λ‹¤.

  - - μμ†μ„± μ»¨ν…μ¤νΈ? 

      μμ†μ„± μ»¨ν…μ¤νΈ(persistence context)λ” JPAκ°€ μ—”ν‹°ν‹°λ¥Ό κ΄€λ¦¬ν•λ” λ…Όλ¦¬μ μΈ μμ—­μ…λ‹λ‹¤. μ¦‰, μ—”ν‹°ν‹° λ§¤λ‹μ €(entity manager)κ°€ κ΄€λ¦¬ν•λ” μ—”ν‹°ν‹° κ°μ²΄λ“¤μ΄ μμ†μ„± μ»¨ν…μ¤νΈ λ‚΄λ¶€μ—μ„ κ΄€λ¦¬λ©λ‹λ‹¤.

      μμ†μ„± μ»¨ν…μ¤νΈλ” μ—”ν‹°ν‹°λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•κ±°λ‚, μ΅°ν, μμ •, μ‚­μ  λ“±μ μ‘μ—…μ„ μν–‰ν•  λ• μ‚¬μ©λ©λ‹λ‹¤. μμ†μ„± μ»¨ν…μ¤νΈλ” μ—”ν‹°ν‹° λ§¤λ‹μ €λ¥Ό ν†µν•΄ μƒμ„±λκ³ , μ—”ν‹°ν‹° λ§¤λ‹μ €κ°€ μ†λ©Έλ  λ• ν•¨κ» μ†λ©Έλ©λ‹λ‹¤.

      μμ†μ„± μ»¨ν…μ¤νΈλ” λ‹¤μκ³Ό κ°™μ€ μ£Όμ”ν• νΉμ§•μ„ κ°–μµλ‹λ‹¤.

      - μ—”ν‹°ν‹°μ μƒλ…μ£ΌκΈ°λ¥Ό κ΄€λ¦¬ν•©λ‹λ‹¤.
      - 1μ°¨ μΊμ‹(First-Level Cache)λ¥Ό μ κ³µν•©λ‹λ‹¤. κ°™μ€ μ—”ν‹°ν‹°κ°€ μ—¬λ¬ λ² μ΅°νλ  λ• μΊμ‹μ—μ„ κ°€μ Έμ¤κΈ° λ•λ¬Έμ—, λ°μ΄ν„°λ² μ΄μ¤μ— λ§¤λ² μ ‘κ·Όν•μ§€ μ•μ•„λ„ λ©λ‹λ‹¤.
      - Dirty Checking κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. μ—”ν‹°ν‹°κ°€ λ³€κ²½λμ—λ”μ§€ μ—¬λ¶€λ¥Ό νλ‹¨ν•μ—¬ λ³€κ²½μ΄ κ°μ§€λλ©΄ μλ™μΌλ΅ UPDATE μΏΌλ¦¬λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.
      - νΈλμ­μ…μ„ μ§€μ›ν•©λ‹λ‹¤. νΈλμ­μ…μ„ μ‹μ‘ν•λ©΄ μμ†μ„± μ»¨ν…μ¤νΈκ°€ μ‹μ‘λκ³ , νΈλμ­μ…μ„ μ»¤λ°‹ν•κ±°λ‚ λ΅¤λ°±ν•λ©΄ μμ†μ„± μ»¨ν…μ¤νΈλ„ ν•¨κ» μΆ…λ£λ©λ‹λ‹¤.

  

















